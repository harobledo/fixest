<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Lags a variable using a formula — lag.formula • fixest</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Lags a variable using a formula — lag.formula" />
<meta property="og:description" content="Lags a variable using panel id + time identifiers in a formula." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fixest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/exporting_tables.html">Exporting estimation tables</a>
    </li>
    <li>
      <a href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short introduction</a>
    </li>
    <li>
      <a href="../articles/multiple_estimations.html">Multiple estimations</a>
    </li>
    <li>
      <a href="../articles/standard_errors.html">On standard-errors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/lrberge/fixest/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Lags a variable using a formula</h1>
    <small class="dont-index">Source: <a href='https://github.com/lrberge/fixest/blob/master/R/Lagging.R'><code>R/Lagging.R</code></a></small>
    <div class="hidden name"><code>lag.formula.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Lags a variable using panel id + time identifiers in a formula.</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for formula</span>
<span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span>
  <span class='va'>x</span>,
  k <span class='op'>=</span> <span class='fl'>1</span>,
  <span class='va'>data</span>,
  time.step <span class='op'>=</span> <span class='cn'>NULL</span>,
  fill <span class='op'>=</span> <span class='cn'>NA</span>,
  duplicate.method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"none"</span>, <span class='st'>"first"</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A formula of the type <code>var ~ id + time</code> where <code>var</code> is the variable to be lagged, <code>id</code> is a variable representing the panel id, and <code>time</code> is the time variable of the panel.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>An integer giving the number of lags. Default is 1. For leads, just use a negative number.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>Optional, the data.frame in which to evaluate the formula. If not provided, variables will be fetched in the current environment.</p></td>
    </tr>
    <tr>
      <th>time.step</th>
      <td><p>The method to compute the lags, default is <code>NULL</code> (which means automatically set). Can be equal to: <code>"unitary"</code>, <code>"consecutive"</code>, <code>"within.consecutive"</code>, or to a number. If <code>"unitary"</code>, then the largest common divisor between consecutive time periods is used (typically if the time variable represents years, it will be 1). This method can apply only to integer (or convertible to integer) variables. If <code>"consecutive"</code>, then the time variable can be of any type: two successive time periods represent a lag of 1. If <code>"witihn.consecutive"</code> then **within a given id**, two successive time periods represent a lag of 1. Finally, if the time variable is numeric, you can provide your own numeric time step.</p></td>
    </tr>
    <tr>
      <th>fill</th>
      <td><p>Scalar. How to fill the observations without defined lead/lag values. Default is <code>NA</code>.</p></td>
    </tr>
    <tr>
      <th>duplicate.method</th>
      <td><p>If several observations have the same id and time values, then the notion of lag is not defined for them. If <code>duplicate.method = "none"</code> (default) and duplicate values are found, this leads to an error. You can use <code>duplicate.method = "first"</code> so that the first occurrence of identical id/time observations will be used as lag.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Not currently used.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>It returns a vector of the same type and length as the variable to be lagged in the formula.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Alternatively, the function <code><a href='panel.html'>panel</a></code> changes a <code>data.frame</code> into a panel from which the functions <code>l</code> and <code>f</code> (creating leads and lags) can be called. Otherwise you can set the panel 'live' during the estimation using the argument <code>panel.id</code> (see for example in the function <code><a href='feols.html'>feols</a></code>).</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Laurent Berge</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># simple example with an unbalanced panel</span>
<span class='va'>base</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>, each <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>,
                  time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>1</span>, <span class='fl'>4</span>, <span class='fl'>6</span>, <span class='fl'>9</span><span class='op'>)</span>, x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>8</span><span class='op'>)</span>

<span class='va'>base</span><span class='op'>$</span><span class='va'>lag1</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>,  <span class='fl'>1</span>, <span class='va'>base</span><span class='op'>)</span> <span class='co'># lag 1</span>
<span class='va'>base</span><span class='op'>$</span><span class='va'>lead1</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>, <span class='op'>-</span><span class='fl'>1</span>, <span class='va'>base</span><span class='op'>)</span> <span class='co'># lead 1</span>
<span class='va'>base</span><span class='op'>$</span><span class='va'>lag2_fill0</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>, <span class='fl'>2</span>, <span class='va'>base</span>, fill <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>
<span class='co'># with time.step = "consecutive"</span>
<span class='va'>base</span><span class='op'>$</span><span class='va'>lag1_consecutive</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>, <span class='fl'>1</span>, <span class='va'>base</span>, time.step <span class='op'>=</span> <span class='st'>"consecutive"</span><span class='op'>)</span>
<span class='co'>#   =&gt; works for indiv. 2 because 9 (resp. 6) is consecutive to 6 (resp. 4)</span>
<span class='va'>base</span><span class='op'>$</span><span class='va'>lag1_within.consecutive</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>, <span class='fl'>1</span>, <span class='va'>base</span>, time.step <span class='op'>=</span> <span class='st'>"within"</span><span class='op'>)</span>
<span class='co'>#   =&gt; now two consecutive years within each indiv is one lag</span>

<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>base</span><span class='op'>)</span>
</div><div class='output co'>#&gt;   id time x lag1 lead1 lag2_fill0 lag1_consecutive lag1_within.consecutive
#&gt; 1  1    1 1   NA     2          0               NA                      NA
#&gt; 2  1    2 2    1     3          0                1                       1
#&gt; 3  1    3 3    2     4          1                2                       2
#&gt; 4  1    4 4    3    NA          2                3                       3
#&gt; 5  2    1 5   NA    NA          0               NA                      NA
#&gt; 6  2    4 6   NA    NA          0               NA                       5
#&gt; 7  2    6 7   NA    NA          6                6                       6
#&gt; 8  2    9 8   NA    NA          0                7                       7</div><div class='input'>
<span class='co'># Argument time.step = "consecutive" is</span>
<span class='co'># mostly useful when the time variable is not a number:</span>
<span class='co'># e.g. c("1991q1", "1991q2", "1991q3") etc</span>

<span class='co'># with duplicates</span>
<span class='va'>base_dup</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>, each <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>,
                      time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>, x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>8</span><span class='op'>)</span>

<span class='co'># Error because of duplicate values for (id, time)</span>
<span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>, <span class='fl'>1</span>, <span class='va'>base_dup</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Error : in lag.formula(x ~ id + time, 1, base_dup):
#&gt;  The panel identifiers contain duplicate values: this is not allowed
#&gt; since lag/leads are not defined for them. For example (id, time) = (1,
#&gt; 1) appears three times. Please provide data without duplicates -- or you
#&gt; can also use duplicate.method = 'first' (see Details).</div><div class='input'>

<span class='co'># Error is bypassed, lag corresponds to first occurence of (id, time)</span>
<span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>, <span class='fl'>1</span>, <span class='va'>base_dup</span>, duplicate.method <span class='op'>=</span> <span class='st'>"first"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] NA NA NA  1 NA  5  5  6</div><div class='input'>

<span class='co'># Playing with time steps</span>
<span class='va'>base</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>, each <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>,
                  time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>1</span>, <span class='fl'>4</span>, <span class='fl'>6</span>, <span class='fl'>9</span><span class='op'>)</span>, x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>8</span><span class='op'>)</span>

<span class='co'># time step: 0.5 (here equivalent to lag of 1)</span>
<span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>, <span class='fl'>2</span>, <span class='va'>base</span>, time.step <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] NA  1  2  3 NA NA NA NA</div><div class='input'>
<span class='co'># Error: wrong time step</span>
<span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>, <span class='fl'>2</span>, <span class='va'>base</span>, time.step <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Error : in lag.formula(x ~ id + time, 2, base, time.step = 7):
#&gt;  If 'time.step' is a number, then it must be an exact divisor of all the
#&gt; difference between two consecutive time periods. This is currently not
#&gt; the case: 7 is not a divisor of 1 (the difference btw the time periods 2
#&gt; and 1).</div><div class='input'>
<span class='co'># Adding NAs + unsorted IDs</span>
<span class='va'>base</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>, each <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>,
                  time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='cn'>NA</span>, <span class='fl'>3</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='cn'>NA</span>, <span class='fl'>1</span>, <span class='fl'>3</span><span class='op'>)</span>, x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>8</span><span class='op'>)</span>

<span class='va'>base</span><span class='op'>$</span><span class='va'>lag1</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>, <span class='fl'>1</span>, <span class='va'>base</span><span class='op'>)</span>
<span class='va'>base</span><span class='op'>$</span><span class='va'>lag1_within</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>time</span>, <span class='fl'>1</span>, <span class='va'>base</span>, time.step <span class='op'>=</span> <span class='st'>"w"</span><span class='op'>)</span>
<span class='va'>base_bis</span> <span class='op'>=</span> <span class='va'>base</span><span class='op'>[</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/setorder.html'>order</a></span><span class='op'>(</span><span class='va'>base</span><span class='op'>$</span><span class='va'>id</span>, <span class='va'>base</span><span class='op'>$</span><span class='va'>time</span><span class='op'>)</span>,<span class='op'>]</span>

<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>base_bis</span><span class='op'>)</span>
</div><div class='output co'>#&gt;   id time x lag1 lag1_within
#&gt; 4  1    1 4   NA          NA
#&gt; 3  1    3 3   NA           4
#&gt; 1  1    4 1    3           3
#&gt; 2  1   NA 2   NA          NA
#&gt; 7  2    1 7   NA          NA
#&gt; 5  2    2 5    7           7
#&gt; 8  2    3 8    5           5
#&gt; 6  2   NA 6   NA          NA</div><div class='input'>
<span class='co'># You can create variables without specifying the data within data.table:</span>
<span class='kw'>if</span><span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='st'><a href='https://r-datatable.com'>"data.table"</a></span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>base</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>, each <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>, year <span class='op'>=</span> <span class='fl'>1990</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, <span class='fl'>2</span><span class='op'>)</span>, x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span><span class='op'>)</span>
  <span class='va'>base</span><span class='op'>[</span>, <span class='va'>x.l1</span> <span class='op'>:=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/shift.html'>lag</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>year</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>]</span>
<span class='op'>}</span>
</div><div class='output co'>#&gt;    id year x x.l1
#&gt; 1:  1 1991 1   NA
#&gt; 2:  1 1992 2    1
#&gt; 3:  1 1993 3    2
#&gt; 4:  2 1991 4   NA
#&gt; 5:  2 1992 5    4
#&gt; 6:  2 1993 6    5</div><div class='input'>


</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


