<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Constructs a fixest panel data base — panel • fixest</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Constructs a fixest panel data base — panel" />
<meta property="og:description" content="Constructs a fixest panel data base out of a data.frame which allows to use leads and lags in fixest estimations and to create new variables from leads and lags if the data.frame was also a data.table." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fixest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/exporting_tables.html">Exporting estimation tables</a>
    </li>
    <li>
      <a href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short introduction</a>
    </li>
    <li>
      <a href="../articles/multiple_estimations.html">Multiple estimations</a>
    </li>
    <li>
      <a href="../articles/standard_errors.html">On standard-errors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/lrberge/fixest/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Constructs a <code>fixest</code> panel data base</h1>
    <small class="dont-index">Source: <a href='https://github.com/lrberge/fixest/blob/master/R/Lagging.R'><code>R/Lagging.R</code></a></small>
    <div class="hidden name"><code>panel.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Constructs a <code>fixest</code> panel data base out of a data.frame which allows to use leads and lags in <code>fixest</code> estimations and to create new variables from leads and lags if the data.frame was also a <code><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>panel</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>panel.id</span>, time.step <span class='op'>=</span> <span class='cn'>NULL</span>, duplicate.method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"none"</span>, <span class='st'>"first"</span><span class='op'>)</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A data.frame.</p></td>
    </tr>
    <tr>
      <th>panel.id</th>
      <td><p>The panel identifiers. Can either be: i) a one sided formula (e.g. <code>panel.id = ~id+time</code>), ii) a character vector of length 2 (e.g. <code>panel.id=c('id', 'time')</code>, or iii) a character scalar of two variables separated by a comma (e.g. <code>panel.id='id,time'</code>). Note that you can combine variables with <code><a href='https://rdrr.io/r/base/Arithmetic.html'>^</a></code> only inside formulas (see the dedicated section in <code><a href='feols.html'>feols</a></code>).</p></td>
    </tr>
    <tr>
      <th>time.step</th>
      <td><p>The method to compute the lags, default is <code>NULL</code> (which means automatically set). Can be equal to: <code>"unitary"</code>, <code>"consecutive"</code>, <code>"within.consecutive"</code>, or to a number. If <code>"unitary"</code>, then the largest common divisor between consecutive time periods is used (typically if the time variable represents years, it will be 1). This method can apply only to integer (or convertible to integer) variables. If <code>"consecutive"</code>, then the time variable can be of any type: two successive time periods represent a lag of 1. If <code>"witihn.consecutive"</code> then **within a given id**, two successive time periods represent a lag of 1. Finally, if the time variable is numeric, you can provide your own numeric time step.</p></td>
    </tr>
    <tr>
      <th>duplicate.method</th>
      <td><p>If several observations have the same id and time values, then the notion of lag is not defined for them. If <code>duplicate.method = "none"</code> (default) and duplicate values are found, this leads to an error. You can use <code>duplicate.method = "first"</code> so that the first occurrence of identical id/time observations will be used as lag.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>It returns a data base identical to the one given in input, but with an additional attribute: &#8220;panel_info&#8221;. This attribute contains vectors used to efficiently create lags/leads of the data. When the data is subselected, some bookeeping is performed on the attribute &#8220;panel_info&#8221;.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function allows you to use leads and lags in a <code>fixest</code> estimation without having to provide the argument <code>panel.id</code>. It also offers more options on how to set the panel (with the additional arguments 'time.step' and 'duplicate.method').</p>
<p>When the initial data set was also a <code>data.table</code>, not all operations are supported and some may dissolve the <code>fixest_panel</code>. This is the case when creating subselections of the initial data with additional attributes (e.g. pdt[x&gt;0, .(x, y, z)] would dissolve the <code>fixest_panel</code>, meaning only a data.table would be the result of the call).</p>
<p>If the initial data set was also a <code>data.table</code>, then you can create new variables from lags and leads using the functions <code><a href='f.html'>l</a></code>() and <code><a href='f.html'>f</a></code>(). See the example.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>The estimation methods <code><a href='feols.html'>feols</a></code>, <code><a href='feglm.html'>fepois</a></code> and <code><a href='feglm.html'>feglm</a></code>.</p>
<p>The functions <code><a href='f.html'>l</a></code> and <code><a href='f.html'>f</a></code> to create lags and leads within <code></code>fixest_panel objects.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Laurent Berge</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>base_did</span><span class='op'>)</span>

<span class='co'># Setting a data set as a panel...</span>
<span class='va'>pdat</span> <span class='op'>=</span> <span class='fu'>panel</span><span class='op'>(</span><span class='va'>base_did</span>, <span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>period</span><span class='op'>)</span>

<span class='co'># ...then using the functions l and f</span>
<span class='va'>est1</span> <span class='op'>=</span> <span class='fu'><a href='feols.html'>feols</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>~</span><span class='fu'><a href='f.html'>l</a></span><span class='op'>(</span><span class='va'>x1</span>, <span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>, <span class='va'>pdat</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>NOTE: 108 observations removed because of NA values (RHS: 108).</span></div><div class='input'><span class='va'>est2</span> <span class='op'>=</span> <span class='fu'><a href='feols.html'>feols</a></span><span class='op'>(</span><span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>~</span><span class='fu'><a href='f.html'>l</a></span><span class='op'>(</span><span class='va'>x1</span>, <span class='op'>-</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>, <span class='va'>pdat</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>NOTE: 216 observations removed because of NA values (LHS: 108, RHS: 216).</span></div><div class='input'><span class='va'>est3</span> <span class='op'>=</span> <span class='fu'><a href='feols.html'>feols</a></span><span class='op'>(</span><span class='fu'><a href='f.html'>l</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>~</span><span class='fu'><a href='f.html'>l</a></span><span class='op'>(</span><span class='va'>x1</span>, <span class='fl'>0</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span>, <span class='va'>pdat</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>NOTE: 324 observations removed because of NA values (LHS: 108, RHS: 324).</span></div><div class='input'><span class='fu'><a href='etable.html'>etable</a></span><span class='op'>(</span><span class='va'>est1</span>, <span class='va'>est2</span>, <span class='va'>est3</span>, order <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"f"</span>, <span class='st'>"^x"</span><span class='op'>)</span>, drop<span class='op'>=</span><span class='st'>"Int"</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                               est1               est2               est3
#&gt; Dependent Var.:                  y             f(y,1)             l(y,1)
#&gt;                                                                         
#&gt; f(x1,1)                            0.9940*** (0.0542)                   
#&gt; x1              0.9948*** (0.0487)    0.0081 (0.0592)   -0.0534 (0.0545)
#&gt; l(x1,1)            0.0410 (0.0558)    0.0157 (0.0640) 0.9871*** (0.0551)
#&gt; l(x1,2)                                                  0.0220 (0.0580)
#&gt; l(x1,3)                                                  0.0102 (0.0639)
#&gt; _______________ __________________ __________________ __________________
#&gt; S.E.: Clustered             by: id             by: id             by: id
#&gt; Observations                   972                864                756
#&gt; R2                         0.26558            0.25697            0.25875
#&gt; Adj. R2                    0.26406            0.25438            0.25480</div><div class='input'>
<span class='co'># or using the argument panel.id</span>
<span class='fu'><a href='feols.html'>feols</a></span><span class='op'>(</span><span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>~</span><span class='fu'><a href='f.html'>l</a></span><span class='op'>(</span><span class='va'>x1</span>, <span class='op'>-</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>, <span class='va'>base_did</span>, panel.id <span class='op'>=</span> <span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>period</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>NOTE: 216 observations removed because of NA values (LHS: 108, RHS: 216).</span></div><div class='output co'>#&gt; OLS estimation, Dep. Var.: f(y, 1)
#&gt; Observations: 864 
#&gt; Standard-errors: Clustered (id) 
#&gt;             Estimate Std. Error   t value Pr(&gt;|t|))    
#&gt; (Intercept) 2.464300   0.223277 11.037000 &lt; 2.2e-16 ***
#&gt; f(x1, 1)    0.994018   0.054216 18.335000 &lt; 2.2e-16 ***
#&gt; x1          0.008072   0.059247  0.136241  0.891887    
#&gt; l(x1, 1)    0.015693   0.063958  0.245360  0.806648    
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; RMSE: 4.9742   Adj. R2: 0.254377</div><div class='input'>
<span class='co'># You can use panel.id in various ways:</span>
<span class='va'>pdat</span> <span class='op'>=</span> <span class='fu'>panel</span><span class='op'>(</span><span class='va'>base_did</span>, <span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>period</span><span class='op'>)</span>
<span class='co'># is identical to:</span>
<span class='va'>pdat</span> <span class='op'>=</span> <span class='fu'>panel</span><span class='op'>(</span><span class='va'>base_did</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"id"</span>, <span class='st'>"period"</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># and also to:</span>
<span class='va'>pdat</span> <span class='op'>=</span> <span class='fu'>panel</span><span class='op'>(</span><span class='va'>base_did</span>, <span class='st'>"id,period"</span><span class='op'>)</span>

<span class='co'># l() and f() can also be used within a data.table:</span>
<span class='kw'>if</span><span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='st'><a href='https://r-datatable.com'>"data.table"</a></span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>pdat_dt</span> <span class='op'>=</span> <span class='fu'>panel</span><span class='op'>(</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html'>as.data.table</a></span><span class='op'>(</span><span class='va'>base_did</span><span class='op'>)</span>, <span class='op'>~</span><span class='va'>id</span><span class='op'>+</span><span class='va'>period</span><span class='op'>)</span>
  <span class='co'># Now since pdat_dt is also a data.table</span>
  <span class='co'>#   you can create lags/leads directly</span>
  <span class='va'>pdat_dt</span><span class='op'>[</span>, <span class='va'>x1_l1</span> <span class='op'>:=</span> <span class='fu'><a href='f.html'>l</a></span><span class='op'>(</span><span class='va'>x1</span><span class='op'>)</span><span class='op'>]</span>
  <span class='va'>pdat_dt</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x1_l1_fill0"</span>, <span class='st'>"y_f2"</span><span class='op'>)</span> <span class='op'>:=</span> <span class='fu'>.</span><span class='op'>(</span><span class='fu'><a href='f.html'>l</a></span><span class='op'>(</span><span class='va'>x1</span>, fill <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>, <span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='va'>y</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>]</span>
<span class='op'>}</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


