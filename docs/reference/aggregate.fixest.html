<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aggregates the values of DiD coefficients a la Sun and Abraham — aggregate.fixest • fixest</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Aggregates the values of DiD coefficients a la Sun and Abraham — aggregate.fixest" />
<meta property="og:description" content="Simple tool that aggregates the value of CATT coefficients in staggered difference-in-difference setups (see details)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fixest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/exporting_tables.html">Exporting estimation tables</a>
    </li>
    <li>
      <a href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short introduction</a>
    </li>
    <li>
      <a href="../articles/multiple_estimations.html">Multiple estimations</a>
    </li>
    <li>
      <a href="../articles/standard_errors.html">On standard-errors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/lrberge/fixest/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregates the values of DiD coefficients a la Sun and Abraham</h1>
    <small class="dont-index">Source: <a href='https://github.com/lrberge/fixest/blob/master/R/did.R'><code>R/did.R</code></a></small>
    <div class="hidden name"><code>aggregate.fixest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Simple tool that aggregates the value of CATT coefficients in staggered difference-in-difference setups (see details).</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for fixest</span>
<span class='fu'><a href='https://rdrr.io/r/stats/aggregate.html'>aggregate</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>agg</span>, full <span class='op'>=</span> <span class='cn'>FALSE</span>, use_weights <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A <code>fixest</code> object.</p></td>
    </tr>
    <tr>
      <th>agg</th>
      <td><p>A character scalar describing the variable names to be aggregated, it is pattern-based. All variables that match the pattern will be aggregated. It must be of the form <code>"(root)"</code>, the parentheses must be there and the resulting variable name will be <code>"root"</code>. You can add another root with parentheses: <code>"(root1)regex(root2)"</code>, in which case the resulting name is <code>"root1::root2"</code>. To name the resulting variable differently you can pass a named vector: <code><a href='https://rdrr.io/r/base/c.html'>c("name" = "pattern")</a></code> or <code><a href='https://rdrr.io/r/base/c.html'>c("name" = "pattern(root2)")</a></code>. It's a bit intricate sorry, please see the examples.</p></td>
    </tr>
    <tr>
      <th>full</th>
      <td><p>Logical scalar, defaults to <code>FALSE</code>. If <code>TRUE</code>, then all coefficients are returned, not only the aggregated coefficients.</p></td>
    </tr>
    <tr>
      <th>use_weights</th>
      <td><p>Logical, default is <code>TRUE</code>. If the estimation was weighted, whether the aggregation should take into account the weights. Basically if the weights reflected frequency it should be <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments to be passed to <code><a href='summary.fixest.html'>summary.fixest</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>It returns a matrix representing a table of coefficients.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This is a function helping to replicate the estimator from Sun and Abraham (2020). You first need to perform an estimation with cohort and relative periods dummies (typically using the function <code><a href='i.html'>i</a></code>), this leads to estimators of the cohort average treatment effect on the treated (CATT). Then you can use this function to retrieve the average treatment effect on each relative period, or for any other way you wish to aggregate the CATT.</p>
<p>Note that contrary to the SA article, here the cohort share in the sample is considered to be a perfect measure for the cohort share in the population.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Liyang Sun and Sarah Abraham, forthcoming, "Estimating Dynamic Treatment Effects in Event Studies with Heterogeneous Treatment Effects". Journal of Econometrics.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Laurent Berge</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>#</span>
<span class='co'># DiD example</span>
<span class='co'>#</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>base_stagg</span><span class='op'>)</span>

<span class='co'># 2 kind of estimations:</span>
<span class='co'># - regular TWFE model</span>
<span class='co'># - estimation with cohort x time_to_treatment interactions, later aggregated</span>

<span class='co'># Note: the never treated have a time_to_treatment equal to -1000</span>

<span class='co'># Now we perform the estimation</span>
<span class='va'>res_twfe</span> <span class='op'>=</span> <span class='fu'><a href='feols.html'>feols</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x1</span> <span class='op'>+</span> <span class='fu'><a href='i.html'>i</a></span><span class='op'>(</span><span class='va'>time_to_treatment</span>, <span class='va'>treated</span>,
                            ref <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, <span class='op'>-</span><span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|</span> <span class='va'>id</span> <span class='op'>+</span> <span class='va'>year</span>, <span class='va'>base_stagg</span><span class='op'>)</span>

<span class='co'># we use the "i." prefix to force year_treated to be considered as a factor</span>
<span class='va'>res_cohort</span> <span class='op'>=</span> <span class='fu'><a href='feols.html'>feols</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x1</span> <span class='op'>+</span> <span class='fu'><a href='i.html'>i</a></span><span class='op'>(</span><span class='va'>time_to_treatment</span>, <span class='va'>i.year_treated</span>,
                              ref <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, <span class='op'>-</span><span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|</span> <span class='va'>id</span> <span class='op'>+</span> <span class='va'>year</span>, <span class='va'>base_stagg</span><span class='op'>)</span>

<span class='co'># Displaying the results</span>
<span class='fu'><a href='coefplot.html'>iplot</a></span><span class='op'>(</span><span class='va'>res_twfe</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>6</span>, <span class='fl'>8</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='input'><span class='va'>att_true</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tapply.html'>tapply</a></span><span class='op'>(</span><span class='va'>base_stagg</span><span class='op'>$</span><span class='va'>treatment_effect_true</span>,
                  <span class='va'>base_stagg</span><span class='op'>$</span><span class='va'>time_to_treatment</span>, <span class='va'>mean</span><span class='op'>)</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>9</span><span class='op'>:</span><span class='fl'>8</span> <span class='op'>+</span> <span class='fl'>0.15</span>, <span class='va'>att_true</span>, pch <span class='op'>=</span> <span class='fl'>15</span>, col <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='input'>
<span class='co'># The aggregate effect for each period</span>
<span class='va'>agg_coef</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/aggregate.html'>aggregate</a></span><span class='op'>(</span><span class='va'>res_cohort</span>, <span class='st'>"(ti.*nt)::(-?[[:digit:]]+)"</span><span class='op'>)</span>
<span class='va'>x</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>9</span><span class='op'>:</span><span class='op'>-</span><span class='fl'>2</span>, <span class='fl'>0</span><span class='op'>:</span><span class='fl'>8</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>.35</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>agg_coef</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>, pch <span class='op'>=</span> <span class='fl'>17</span>, col <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
</div><div class='input'><span class='va'>ci_low</span> <span class='op'>=</span> <span class='va'>agg_coef</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>-</span> <span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>agg_coef</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span>
<span class='va'>ci_up</span> <span class='op'>=</span> <span class='va'>agg_coef</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>agg_coef</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/segments.html'>segments</a></span><span class='op'>(</span>x0 <span class='op'>=</span> <span class='va'>x</span>, y0 <span class='op'>=</span> <span class='va'>ci_low</span>, x1 <span class='op'>=</span> <span class='va'>x</span>, y1 <span class='op'>=</span> <span class='va'>ci_up</span>, col <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"topleft"</span>, col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>4</span><span class='op'>)</span>, pch <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>20</span>, <span class='fl'>15</span>, <span class='fl'>17</span><span class='op'>)</span>,
       legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"TWFE"</span>, <span class='st'>"True"</span>, <span class='st'>"Sun &amp; Abraham"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='img'><img src='aggregate.fixest-1.png' alt='' width='700' height='433' /></div><div class='input'>

<span class='co'># The ATT</span>
<span class='fu'><a href='https://rdrr.io/r/stats/aggregate.html'>aggregate</a></span><span class='op'>(</span><span class='va'>res_cohort</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ATT"</span> <span class='op'>=</span> <span class='st'>"treatment::[^-]"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;      Estimate Std. Error   t value     Pr(&gt;|t|)
#&gt; ATT -1.133749  0.2050705 -5.528584 4.433042e-08</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>base_stagg</span>, <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>treatment_effect_true</span><span class='op'>[</span><span class='va'>time_to_treatment</span> <span class='op'>&gt;=</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] -1</div><div class='input'>
<span class='co'># The total effect for each cohort</span>
<span class='fu'><a href='https://rdrr.io/r/stats/aggregate.html'>aggregate</a></span><span class='op'>(</span><span class='va'>res_cohort</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"cohort"</span> <span class='op'>=</span> <span class='st'>"::[^-].*year_treated::([[:digit:]]+)"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;              Estimate Std. Error     t value     Pr(&gt;|t|)
#&gt; cohort::2   2.4347382  0.2860464   8.5116905 9.025691e-17
#&gt; cohort::3   1.3766102  0.6197413   2.2212658 2.662536e-02
#&gt; cohort::4   0.7543763  0.8054956   0.9365368 3.492928e-01
#&gt; cohort::5  -2.8079538  0.3865452  -7.2642310 9.268255e-13
#&gt; cohort::6  -2.7225787  0.5950041  -4.5757310 5.536587e-06
#&gt; cohort::7  -5.0751928  0.5676398  -8.9408692 2.867999e-18
#&gt; cohort::8  -5.0928206  0.3505856 -14.5266109 2.131325e-42
#&gt; cohort::9  -7.2367302  0.3288544 -22.0058788 1.653025e-83
#&gt; cohort::10 -8.7115753  0.5128055 -16.9880706 3.781525e-55</div><div class='input'>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


